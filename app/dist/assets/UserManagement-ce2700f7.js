import{d as Q,G as D,r as c,o as X,b as s,C as Y,e as z,B as Z,h as a,g as t,j as _,i as U,k as ee,W as ae,D as le,f as F,L as te,E as b,F as oe}from"./index-a7f98987.js";import{r as k}from"./request-e257bb45.js";import{_ as re}from"./_plugin-vue_export-helper-c27b6911.js";import"./axios-3a665b0f.js";const se=i=>k({url:"/user",method:"post",data:i}),A=i=>k({url:"/user",method:"get",params:i}),ne=i=>k({url:`/user/${i}`,method:"delete"}),ue=(i,n)=>k({url:`/user/${i}`,method:"put",data:n}),de={class:"user-management"},ie={class:"card-header"},me={class:"pagination-container"},pe={class:"dialog-footer"},ce=Q({__name:"UserManagement",setup(i){const n=D({username:"",email:""}),V=c(!1),u=c([]),g=c(1),w=c(10),d=c(0),h=c(!1),y=c("add"),x=c(),r=D({username:"",email:"",number:"",passwordHash:""}),E={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],number:[{required:!0,message:"请输入号码",trigger:"blur"}],passwordHash:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}]},S=async()=>{V.value=!0;try{const l=await A({page:g.value,size:w.value});if(console.log("Full Axios Response:",l),!l){console.error("No response received"),u.value=[],d.value=0;return}const e=l.data||l;console.log("Processed Response:",e),e!=null&&e.content?(u.value=e.content,d.value=e.totalElements):(u.value=[],d.value=0,console.error("Invalid response format:",e))}catch(l){console.error("获取用户列表失败:",l),b.error("获取用户列表失败"),u.value=[],d.value=0}finally{V.value=!1}},C=async()=>{V.value=!0;try{const l=await A({username:n.username,email:n.email,page:g.value,size:w.value});if(console.log("Full Search Response:",l),!l){console.error("No search response received"),u.value=[],d.value=0;return}const e=l.data||l;console.log("Processed Search Response:",e),e!=null&&e.content?(u.value=e.content,d.value=e.totalElements):(u.value=[],d.value=0,console.error("Invalid search response format:",e))}catch(l){console.error("搜索失败:",l),b.error("搜索失败"),u.value=[],d.value=0}finally{V.value=!1}},H=()=>{n.username="",n.email="",g.value=1,C()},$=l=>{w.value=l,g.value=1,C()},I=l=>{g.value=l,C()},M=()=>{y.value="add",h.value=!0,r.username="",r.email="",r.number="",r.passwordHash=""},N=l=>{y.value="edit",h.value=!0,Object.assign(r,{id:l.id,username:l.username,email:l.email,number:l.number}),r.passwordHash=""},q=async()=>{x.value&&await x.value.validate(async l=>{if(l)try{if(y.value==="add"){const e=new Date().toISOString(),m={...r,role:"user",createdAt:e,updateAt:e,lastLogin:e,photo:null};await se(m),b.success("添加成功")}else{const e={username:r.username,email:r.email,number:r.number,updateAt:new Date().toISOString()};await ue(r.id,e),b.success("修改成功")}h.value=!1,S()}catch(e){console.error("操作失败:",e),b.error(y.value==="add"?"添加失败":"修改失败")}})},j=l=>{oe.confirm(`确定要删除用户 ${l.username} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ne(l.id),b.success("删除成功"),S()}catch{b.error("删除失败")}})};return X(()=>{S()}),(l,e)=>{const m=s("el-input"),v=s("el-form-item"),f=s("el-button"),B=s("el-form"),R=s("el-card"),L=s("el-icon"),p=s("el-table-column"),P=s("el-avatar"),T=s("el-button-group"),O=s("el-table"),G=s("el-pagination"),W=s("el-dialog"),J=Y("loading");return z(),Z("div",de,[a(R,{class:"search-card"},{default:t(()=>[a(B,{inline:!0,model:n,class:"search-form"},{default:t(()=>[a(v,{label:"用户名"},{default:t(()=>[a(m,{modelValue:n.username,"onUpdate:modelValue":e[0]||(e[0]=o=>n.username=o),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),a(v,{label:"邮箱"},{default:t(()=>[a(m,{modelValue:n.email,"onUpdate:modelValue":e[1]||(e[1]=o=>n.email=o),placeholder:"请输入邮箱",clearable:""},null,8,["modelValue"])]),_:1}),a(v,null,{default:t(()=>[a(f,{type:"primary",onClick:C},{default:t(()=>e[10]||(e[10]=[_(" 搜索 ")])),_:1}),a(f,{onClick:H},{default:t(()=>e[11]||(e[11]=[_(" 重置 ")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(R,{class:"table-card"},{header:t(()=>[U("div",ie,[e[13]||(e[13]=U("span",null,"用户列表",-1)),a(f,{type:"primary",onClick:M},{default:t(()=>[a(L,null,{default:t(()=>[a(ee(ae))]),_:1}),e[12]||(e[12]=_(" 新增用户 "))]),_:1})])]),default:t(()=>[le((z(),F(O,{data:u.value,style:{width:"100%"},border:""},{default:t(()=>[a(p,{type:"selection",width:"55"}),a(p,{prop:"id",label:"ID",width:"80"}),a(p,{prop:"photoBase64",label:"头像",width:"80"},{default:t(({row:o})=>[a(P,{size:40,src:o.photoBase64?`data:image/jpeg;base64,${o.photoBase64}`:""},null,8,["src"])]),_:1}),a(p,{prop:"username",label:"用户名"}),a(p,{prop:"email",label:"邮箱"}),a(p,{prop:"number",label:"号码"}),a(p,{prop:"createdAt",label:"创建时间",width:"180"}),a(p,{label:"操作",width:"150",fixed:"right"},{default:t(({row:o})=>[a(T,null,{default:t(()=>[a(f,{type:"primary",link:"",onClick:K=>N(o)},{default:t(()=>e[14]||(e[14]=[_(" 编辑 ")])),_:2},1032,["onClick"]),a(f,{type:"danger",link:"",onClick:K=>j(o)},{default:t(()=>e[15]||(e[15]=[_(" 删除 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[J,V.value]]),U("div",me,[a(G,{"current-page":g.value,"onUpdate:currentPage":e[2]||(e[2]=o=>g.value=o),"page-size":w.value,"onUpdate:pageSize":e[3]||(e[3]=o=>w.value=o),total:d.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:$,onCurrentChange:I},null,8,["current-page","page-size","total"])])]),_:1}),a(W,{modelValue:h.value,"onUpdate:modelValue":e[9]||(e[9]=o=>h.value=o),title:y.value==="add"?"新增用户":"编辑用户",width:"500px"},{footer:t(()=>[U("span",pe,[a(f,{onClick:e[8]||(e[8]=o=>h.value=!1)},{default:t(()=>e[16]||(e[16]=[_("取消")])),_:1}),a(f,{type:"primary",onClick:q},{default:t(()=>e[17]||(e[17]=[_(" 确定 ")])),_:1})])]),default:t(()=>[a(B,{ref_key:"userFormRef",ref:x,model:r,rules:E,"label-width":"100px"},{default:t(()=>[a(v,{label:"用户名",prop:"username"},{default:t(()=>[a(m,{modelValue:r.username,"onUpdate:modelValue":e[4]||(e[4]=o=>r.username=o),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),a(v,{label:"邮箱",prop:"email"},{default:t(()=>[a(m,{modelValue:r.email,"onUpdate:modelValue":e[5]||(e[5]=o=>r.email=o),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),a(v,{label:"号码",prop:"number"},{default:t(()=>[a(m,{modelValue:r.number,"onUpdate:modelValue":e[6]||(e[6]=o=>r.number=o),placeholder:"请输入号码"},null,8,["modelValue"])]),_:1}),y.value==="add"?(z(),F(v,{key:0,label:"密码",prop:"passwordHash"},{default:t(()=>[a(m,{modelValue:r.passwordHash,"onUpdate:modelValue":e[7]||(e[7]=o=>r.passwordHash=o),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})):te("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});const be=re(ce,[["__scopeId","data-v-ff39de98"]]);export{be as default};
