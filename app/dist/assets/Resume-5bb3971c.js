import{d as P,u as S,r as b,o as L,b as y,C as F,e as g,B as M,i as w,h as a,g as i,j as d,D as T,f as U,t as B,E as u,F as j}from"./index-a7f98987.js";import{r as x}from"./request-f6ee6398.js";import{A as v,a as A}from"./index-99461ef4.js";import{_ as q}from"./_plugin-vue_export-helper-c27b6911.js";import"./axios-3a665b0f.js";const N=({title:p,pdfUrl:n,token:o})=>["<!DOCTYPE html>","<html>","<head>",'<meta charset="UTF-8">',`<title>简历预览 - ${p}</title>`,"<style>","body { margin: 0; padding: 0; overflow: hidden; background: #f0f2f5; }",".container { display: flex; flex-direction: column; height: 100vh; }",".loading { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-family: Arial, sans-serif; color: #666; text-align: center; }",".loading .spinner { margin-bottom: 10px; }",".error { color: #f56c6c; }","object { width: 100%; height: 100%; border: none; }","</style>","</head>","<body>",'<div class="container">','<div class="loading">','<div class="spinner">正在加载简历...</div>',"</div>",'<object type="application/pdf">','<p>无法直接预览PDF，请<a href="#" onclick="downloadPDF()">点击下载</a></p>',"</object>","</div>","<script>","function showError(message) {",'  const loading = document.querySelector(".loading");',"  if (loading) {",'    loading.innerHTML = `<div class="error">${message}</div>`;',"  }","}","","function loadPDF() {","  const xhr = new XMLHttpRequest();",`  xhr.open("GET", "${n}", true);`,`  xhr.setRequestHeader("Authorization", "Bearer ${o}");`,'  xhr.responseType = "blob";',"","  xhr.onload = function() {","    if (xhr.status === 200) {",'      const blob = new Blob([xhr.response], { type: "application/pdf" });',"      const url = window.URL.createObjectURL(blob);",'      const obj = document.querySelector("object");',"      if (obj) {","        obj.data = url;",'        const loading = document.querySelector(".loading");','        if (loading) loading.style.display = "none";',"      }","    } else {",'      showError("加载PDF失败，请稍后重试");',"    }","  };","","  xhr.onerror = function() {",'    showError("加载PDF失败，请检查网络连接");',"  };","","  xhr.send();","}","","function downloadPDF() {","  const xhr = new XMLHttpRequest();",`  xhr.open("GET", "${n}", true);`,`  xhr.setRequestHeader("Authorization", "Bearer ${o}");`,'  xhr.responseType = "blob";',"","  xhr.onload = function() {","    if (xhr.status === 200) {",'      const blob = new Blob([xhr.response], { type: "application/pdf" });',"      const url = window.URL.createObjectURL(blob);",'      const a = document.createElement("a");','      a.style.display = "none";',"      a.href = url;",'      a.download = "resume.pdf";',"      document.body.appendChild(a);","      a.click();","      document.body.removeChild(a);","      window.URL.revokeObjectURL(url);","    } else {",'      showError("下载PDF失败，请稍后重试");',"    }","  };","","  xhr.onerror = function() {",'    showError("下载PDF失败，请检查网络连接");',"  };","","  xhr.send();","}","",'document.addEventListener("DOMContentLoaded", function() {',"  loadPDF();","});","<\/script>","</body>","</html>"].join(`
`),O=p=>{const n=Math.min(window.screen.width*.8,1024),o=Math.min(window.screen.height*.8,800),r=window.screen.width/2-n/2,m=window.screen.height/2-o/2,s=window.open("","_blank",`toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=yes, copyhistory=no, width=${n}, height=${o}, top=${m}, left=${r}`);if(s){const h=N(p);s.document.open(),s.document.write(h),s.document.close();return}throw new Error("无法打开预览窗口")},I={class:"resume-container"},H={class:"resume-header"},z={class:"resume-list"},G=P({__name:"Resume",setup(p){const n=S(),o=b(!1),r=b(""),m=b([]),s=async()=>{o.value=!0,r.value="";try{const e=await x.get(v.USER.RESUMES);e.data?m.value=Array.isArray(e.data)?e.data:[e.data]:r.value="获取数据失败"}catch(e){console.error("获取简历列表失败:",e),r.value=e.message||"获取简历列表失败",u.error(r.value)}finally{o.value=!1}},h=e=>e?new Date(e).toLocaleDateString("zh-CN"):"-",E=()=>{n.push("/resumeModel/cool")},R=e=>{n.push(`/resume/edit/${e.id}`)},D=async e=>{try{const t=localStorage.getItem("token");if(!t){u.error("未登录或登录已过期");return}const l=`${A.BASE_URL}${v.USER.RESUMES}/pdf/${e.id}`;O({title:e.title,pdfUrl:l,token:t})}catch(t){console.error("预览PDF失败:",t),u.error("打开PDF预览失败")}},C=e=>{j.confirm("确定要删除这份简历吗？此操作不可恢复","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await x.delete(`${v.USER.RESUMES}/${e.id}`),u.success("删除成功"),s()}catch(t){u.error("删除失败："+(t.message||"未知错误"))}}).catch(()=>{})};return L(()=>{s()}),(e,t)=>{const l=y("el-button"),f=y("el-table-column"),k=y("el-table"),$=F("loading");return g(),M("div",I,[w("div",H,[t[1]||(t[1]=w("h2",null,"我的简历",-1)),a(l,{type:"primary",onClick:E},{default:i(()=>t[0]||(t[0]=[d("创建简历")])),_:1})]),w("div",z,[T((g(),U(k,{data:m.value,style:{width:"100%"},"empty-text":r.value||"暂无简历数据"},{default:i(()=>[a(f,{prop:"title",label:"名称"}),a(f,{prop:"updateTime",label:"更新日期"},{default:i(({row:c})=>[d(B(h(c.updateTime)),1)]),_:1}),a(f,{label:"操作"},{default:i(({row:c})=>[a(l,{type:"primary",link:"",onClick:_=>R(c)},{default:i(()=>t[2]||(t[2]=[d("编辑")])),_:2},1032,["onClick"]),a(l,{type:"success",link:"",onClick:_=>D(c)},{default:i(()=>t[3]||(t[3]=[d("查看")])),_:2},1032,["onClick"]),a(l,{type:"danger",link:"",onClick:_=>C(c)},{default:i(()=>t[4]||(t[4]=[d("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","empty-text"])),[[$,o.value]])])])}}});const K=q(G,[["__scopeId","data-v-178137c0"]]);export{K as default};
