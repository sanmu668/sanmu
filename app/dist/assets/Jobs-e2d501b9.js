import{d as ge,G as ve,r as v,w as Q,o as _e,H as fe,b as u,C as ye,e as d,B as _,h as l,g as a,j as r,i as s,D as W,I as R,J as T,t as i,f as A,L as X,M as we,E as p}from"./index-a7f98987.js";import{r as L}from"./request-f6ee6398.js";import{A as B}from"./index-99461ef4.js";import{_ as he}from"./_plugin-vue_export-helper-c27b6911.js";import"./axios-3a665b0f.js";const ke={class:"jobs-container"},Se={class:"card-header"},be={class:"right"},Ee={class:"job-info"},Ce={class:"title-row"},Ie=["onClick"],Ve={class:"salary"},Je={class:"company-row"},Ne={class:"company-name"},xe={class:"tags-row"},De={key:0,class:"welfare-row"},Re={class:"welfare-item"},Te={class:"welfare-item"},ze={class:"action-area"},Ue={class:"pagination-container"},Ae={key:0,class:"job-detail"},Le={class:"salary-tag"},Be={class:"section"},Me=["innerHTML"],qe={class:"section"},Oe=["innerHTML"],Pe={class:"section"},He={class:"welfare-tags"},$e={class:"dialog-footer"},Fe={key:0,class:"resume-list"},Ge={class:"resume-item"},Ke={class:"resume-title"},Ye={class:"resume-date"},Qe={key:1,class:"empty-tip"},We={class:"dialog-footer"},S="current_job_info",Xe=ge({__name:"Jobs",setup(Ze){const c=ve({keyword:"",city:"",experience:""}),z=v(!1),M=v("recommend"),b=v(1),C=v(10),q=v(0),O=v([]),N=v(!1),n=v(null),w=v(!1),h=v([]),y=v(""),I=v(!1);Q(n,e=>{e&&(console.log("currentJob 发生变化，保存到 localStorage:",e),localStorage.setItem(S,JSON.stringify(e)))},{deep:!0});const Z=()=>{console.group("restoreJobInfo");try{const e=localStorage.getItem(S);console.log("从 localStorage 读取的数据：",e),e?(n.value=JSON.parse(e),console.log("恢复的职位信息：",n.value)):console.log("没有找到保存的职位信息")}catch(e){console.error("恢复职位信息失败：",e),localStorage.removeItem(S)}finally{console.groupEnd()}},x=async()=>{z.value=!0;try{console.log("开始获取职位列表，参数:",{jobName:c.keyword,location:c.city,experience:c.experience,page:b.value,size:C.value});const e=await L.get(B.USER.JOBS,{params:{jobName:c.keyword,location:c.city,experience:c.experience,page:b.value,size:C.value}});console.log("获取到的原始职位数据:",e.data),e.data&&Array.isArray(e.data.content)&&(O.value=e.data.content,q.value=e.data.totalElements)}catch(e){console.error("获取职位列表失败:",e),p.error("获取职位列表失败")}finally{z.value=!1}},P=()=>{b.value=1,x()},j=()=>{c.keyword="",c.city="",c.experience="",P()},ee=e=>{C.value=e,x()},oe=e=>{b.value=e,x()},H=async()=>{console.group("fetchResumeList"),console.log("开始获取简历列表"),I.value=!0;try{if(!localStorage.getItem("token"))throw p.warning("请先登录后再投递简历"),new Error("未登录状态");const o=await L.get(B.USER.RESUMES);if(console.log("简历列表响应:",o),o.data&&o.status===200)h.value=Array.isArray(o.data)?o.data:Array.isArray(o.data.content)?o.data.content:[o.data],console.log("处理后的简历列表:",h.value),h.value.length===0&&p.warning("您还没有创建简历，请先创建简历");else throw console.error("响应数据格式不正确:",o),new Error("获取简历列表失败：响应数据格式不正确")}catch(e){console.error("获取简历列表失败:",e),p.error("获取简历列表失败"),h.value=[]}finally{I.value=!1,console.groupEnd()}},le=e=>e?new Date(e).toLocaleDateString("zh-CN"):"-",$=async e=>{var o,k,f;console.group("showResumeSelect"),console.log("开始选择简历流程，原始职位数据：",e);try{if(!localStorage.getItem("token")){console.log("未登录状态"),p.warning("请先登录后再投递简历");return}if(!e)throw new Error("职位对象为空");if(!e.id||typeof e.id!="number")throw console.error("职位ID类型错误:",typeof e.id,e.id),new Error("职位ID无效");const V={id:Number(e.id),jobName:e.jobName||"未知职位",department:e.department||"未知部门",salaryRange:e.salaryRange||"面议",experience:e.experience||"无要求",education:e.education||"无要求",jobType:e.jobType||"全职",description:e.description||"",requirements:e.requirements||"",company:e.company||"未知公司",location:e.location||"未知地点",tags:typeof e.tags=="string"?e.tags:"",status:e.status||"在招"};n.value=V,console.log("已保存的职位信息：",n.value);try{localStorage.setItem(S,JSON.stringify(V)),console.log("职位信息已保存到 localStorage")}catch(g){console.error("保存职位信息到localStorage失败:",g)}I.value=!0;try{await H(),h.value.length>0?(w.value=!0,y.value=""):p.warning("您还没有创建简历，请先创建简历")}catch(g){console.error("获取简历列表失败：",g),((o=g.response)==null?void 0:o.status)===401?p.error("登录已过期，请重新登录"):p.error(`获取简历列表失败: ${((f=(k=g.response)==null?void 0:k.data)==null?void 0:f.message)||g.message||"未知错误"}`)}}catch(m){console.error("showResumeSelect 出错：",m),p.error(m.message||"选择简历时出错，请重试")}finally{I.value=!1,console.groupEnd()}},te=async()=>{var e;console.group("handleApplyJob"),console.log("开始投递流程");try{if(!y.value){p.warning("请选择要投递的简历"),console.log("未选择简历");return}if(!((e=n.value)!=null&&e.id)){p.error("职位信息无效，请重新选择职位"),w.value=!1;return}console.log("开始调用 applyJob"),await ae()}catch(o){console.error("handleApplyJob 出错：",o),p.error("投递失败，请重试")}finally{console.groupEnd()}},ae=async()=>{var e;console.group("applyJob"),console.log("开始发送投递请求");try{if(!((e=n.value)!=null&&e.id))throw new Error("职位信息无效");if(!localStorage.getItem("token"))throw new Error("未登录状态");const k={jobId:n.value.id,resumeId:y.value};console.log("请求数据：",k);const f=await L.post(B.APPLICATIONS.SUBMIT,k);if(console.log("投递响应：",f),f.status>=200&&f.status<300)p.success("简历投递成功"),w.value=!1,y.value="";else throw new Error("投递失败：服务器返回异常状态码")}catch(o){console.error("投递失败:",o),p.error(o.message||"投递失败，请重试")}finally{console.groupEnd()}},se=e=>{console.group("viewJobDetail"),console.log("查看职位详情，原始数据:",e);try{if(!e)throw new Error("职位对象为空");if(!e.id||typeof e.id!="number")throw console.error("职位ID类型错误:",typeof e.id,e.id),new Error("职位ID无效");n.value={id:Number(e.id),jobName:e.jobName||"未知职位",department:e.department||"未知部门",salaryRange:e.salaryRange||"面议",experience:e.experience||"无要求",education:e.education||"无要求",jobType:e.jobType||"全职",description:e.description||"",requirements:e.requirements||"",company:e.company||"未知公司",location:e.location||"未知地点",tags:typeof e.tags=="string"?e.tags:"",status:e.status||"在招"},console.log("设置当前职位信息:",n.value),N.value=!0}catch(o){console.error("查看职位详情失败:",o),p.error(o.message||"职位信息无效")}finally{console.groupEnd()}};_e(()=>{console.group("组件挂载"),console.log("开始加载职位列表");try{Z(),console.log("恢复的职位信息：",n.value)}catch(e){console.error("恢复职位信息失败：",e)}x(),console.groupEnd()}),fe(()=>{console.group("组件卸载"),console.log("清理本地存储"),localStorage.removeItem(S),console.groupEnd()}),Q(w,async e=>{e&&(console.log("简历选择对话框被打开，重新加载简历列表"),await H())});const ne=()=>{console.log("对话框关闭"),y.value="",n.value=null,localStorage.removeItem(S)},re=()=>{console.log("取消投递"),w.value=!1,y.value="",n.value=null,localStorage.removeItem(S)};return(e,o)=>{const k=u("el-input"),f=u("el-form-item"),m=u("el-option"),V=u("el-select"),g=u("el-button"),ie=u("el-form"),F=u("el-card"),U=u("el-radio-button"),G=u("el-radio-group"),J=u("el-tag"),ce=u("el-pagination"),E=u("el-descriptions-item"),ue=u("el-descriptions"),K=u("el-dialog"),de=u("el-radio"),pe=u("el-empty"),Y=ye("loading");return d(),_("div",ke,[l(F,{class:"search-card mb-20"},{default:a(()=>[l(ie,{model:c,inline:!0},{default:a(()=>[l(f,{label:"职位名称"},{default:a(()=>[l(k,{modelValue:c.keyword,"onUpdate:modelValue":o[0]||(o[0]=t=>c.keyword=t),placeholder:"请输入职位名称"},null,8,["modelValue"])]),_:1}),l(f,{label:"工作城市"},{default:a(()=>[l(V,{modelValue:c.city,"onUpdate:modelValue":o[1]||(o[1]=t=>c.city=t),placeholder:"请选择城市"},{default:a(()=>[l(m,{label:"全部",value:""}),l(m,{label:"北京",value:"北京"}),l(m,{label:"上海",value:"上海"}),l(m,{label:"广州",value:"广州"}),l(m,{label:"深圳",value:"深圳"})]),_:1},8,["modelValue"])]),_:1}),l(f,{label:"工作经验"},{default:a(()=>[l(V,{modelValue:c.experience,"onUpdate:modelValue":o[2]||(o[2]=t=>c.experience=t),placeholder:"请选择工作经验"},{default:a(()=>[l(m,{label:"全部",value:""}),l(m,{label:"应届生",value:"应届生"}),l(m,{label:"1-3年",value:"1-3年"}),l(m,{label:"3-5年",value:"3-5年"}),l(m,{label:"5年以上",value:"5年以上"})]),_:1},8,["modelValue"])]),_:1}),l(f,null,{default:a(()=>[l(g,{type:"primary",onClick:P},{default:a(()=>o[11]||(o[11]=[r("搜索")])),_:1}),l(g,{onClick:j},{default:a(()=>o[12]||(o[12]=[r("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(F,{class:"job-list"},{header:a(()=>[s("div",Se,[o[16]||(o[16]=s("span",null,"推荐职位",-1)),s("div",be,[l(G,{modelValue:M.value,"onUpdate:modelValue":o[3]||(o[3]=t=>M.value=t),size:"small"},{default:a(()=>[l(U,{label:"recommend"},{default:a(()=>o[13]||(o[13]=[r("推荐优先")])),_:1}),l(U,{label:"latest"},{default:a(()=>o[14]||(o[14]=[r("最新发布")])),_:1}),l(U,{label:"salary"},{default:a(()=>o[15]||(o[15]=[r("薪资最高")])),_:1})]),_:1},8,["modelValue"])])])]),default:a(()=>[W((d(),_("div",null,[(d(!0),_(R,null,T(O.value,(t,me)=>(d(),_("div",{key:t.id||me,class:"job-item"},[s("div",Ee,[s("div",Ce,[s("h3",{class:"job-title",onClick:D=>se(t)},i(t.jobName),9,Ie),s("div",Ve,i(t.salaryRange),1)]),s("div",Je,[s("span",Ne,i(t.company),1),l(J,{size:"small",type:"info"},{default:a(()=>[r(i(t.location),1)]),_:2},1024),l(J,{size:"small",type:"info"},{default:a(()=>[r(i(t.experience),1)]),_:2},1024),l(J,{size:"small",type:"info"},{default:a(()=>[r(i(t.education),1)]),_:2},1024)]),s("div",xe,[(d(!0),_(R,null,T(t.tags.split(","),D=>(d(),A(J,{key:D,size:"small",class:"job-tag"},{default:a(()=>[r(i(D),1)]),_:2},1024))),128))]),t.jobType?(d(),_("div",De,[s("span",Re,i(t.jobType),1),s("span",Te,i(t.department),1)])):X("",!0)]),s("div",ze,[l(g,{type:"primary",onClick:D=>$(t)},{default:a(()=>o[17]||(o[17]=[r("立即投递")])),_:2},1032,["onClick"])])]))),128)),s("div",Ue,[l(ce,{"current-page":b.value,"onUpdate:currentPage":o[4]||(o[4]=t=>b.value=t),"page-size":C.value,"onUpdate:pageSize":o[5]||(o[5]=t=>C.value=t),total:q.value,"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ee,onCurrentChange:oe},null,8,["current-page","page-size","total"])])])),[[Y,z.value]])]),_:1}),l(K,{modelValue:N.value,"onUpdate:modelValue":o[8]||(o[8]=t=>N.value=t),title:"职位详情",width:"60%","destroy-on-close":!1},{footer:a(()=>[s("span",$e,[l(g,{onClick:o[6]||(o[6]=t=>N.value=!1)},{default:a(()=>o[21]||(o[21]=[r("关闭")])),_:1}),l(g,{type:"primary",onClick:o[7]||(o[7]=t=>n.value&&$(n.value))},{default:a(()=>o[22]||(o[22]=[r(" 立即投递 ")])),_:1})])]),default:a(()=>[n.value?(d(),_("div",Ae,[s("h2",null,i(n.value.jobName),1),s("div",Le,i(n.value.salaryRange),1),l(ue,{column:2,border:""},{default:a(()=>[l(E,{label:"公司名称"},{default:a(()=>[r(i(n.value.company),1)]),_:1}),l(E,{label:"工作地点"},{default:a(()=>[r(i(n.value.location),1)]),_:1}),l(E,{label:"工作经验"},{default:a(()=>[r(i(n.value.experience),1)]),_:1}),l(E,{label:"学历要求"},{default:a(()=>[r(i(n.value.education),1)]),_:1}),l(E,{label:"工作类型"},{default:a(()=>[r(i(n.value.jobType),1)]),_:1}),l(E,{label:"所属部门"},{default:a(()=>[r(i(n.value.department),1)]),_:1})]),_:1}),s("div",Be,[o[18]||(o[18]=s("h3",null,"职位描述",-1)),s("div",{class:"content",innerHTML:n.value.description},null,8,Me)]),s("div",qe,[o[19]||(o[19]=s("h3",null,"职位要求",-1)),s("div",{class:"content",innerHTML:n.value.requirements},null,8,Oe)]),s("div",Pe,[o[20]||(o[20]=s("h3",null,"职位标签",-1)),s("div",He,[(d(!0),_(R,null,T(n.value.tags.split(","),t=>(d(),A(J,{key:t,class:"welfare-tag"},{default:a(()=>[r(i(t),1)]),_:2},1024))),128))])])])):X("",!0)]),_:1},8,["modelValue"]),l(K,{modelValue:w.value,"onUpdate:modelValue":o[10]||(o[10]=t=>w.value=t),title:"选择简历",width:"60%","destroy-on-close":!1,onClose:ne},{footer:a(()=>[s("span",We,[l(g,{onClick:re},{default:a(()=>o[23]||(o[23]=[r("取消")])),_:1}),l(g,{type:"primary",onClick:we(te,["prevent","stop"])},{default:a(()=>o[24]||(o[24]=[r(" 确定 ")])),_:1})])]),default:a(()=>[W((d(),_("div",null,[h.value.length>0?(d(),_("div",Fe,[l(G,{modelValue:y.value,"onUpdate:modelValue":o[9]||(o[9]=t=>y.value=t)},{default:a(()=>[(d(!0),_(R,null,T(h.value,t=>(d(),A(de,{key:t.id,label:t.id,class:"resume-radio"},{default:a(()=>[s("div",Ge,[s("div",Ke,i(t.title),1),s("div",Ye,i(le(t.updateTime)),1)])]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])):(d(),_("div",Qe,[l(pe,{description:"暂无简历，请先创建简历"})]))])),[[Y,I.value]])]),_:1},8,["modelValue"])])}}});const ao=he(Xe,[["__scopeId","data-v-5a41dfa7"]]);export{ao as default};
