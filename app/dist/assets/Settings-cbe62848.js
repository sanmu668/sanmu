import{d as L,c as O,G as P,r as M,u as T,o as K,b as p,C as Q,e as N,B as W,h as o,g as s,D as I,f as h,i as r,j as v,t as y,E as n}from"./index-a7f98987.js";import{r as B}from"./request-f6ee6398.js";import{_ as X}from"./_plugin-vue_export-helper-c27b6911.js";import"./axios-3a665b0f.js";import"./index-99461ef4.js";const Y={class:"settings-container"},Z={class:"avatar-container"},ee={class:"user-email"},oe={class:"user-stats"},se={class:"stat-item"},ae={class:"stat-value"},re={class:"stat-item"},te={class:"stat-value"},le={class:"stat-item"},ne={class:"stat-value"},de={class:"card-header"},ie={class:"card-header"},ue={class:"card-header"},pe="path/to/default/avatar.png",me=L({__name:"Settings",setup(fe){const R=O(()=>({Authorization:`Bearer ${localStorage.getItem("token")}`})),i=P({profile:!1,basicInfo:!1,password:!1}),m=P({photo:"",username:"",email:"",number:"",applicationCount:0,interviewCount:0,collectionCount:0}),F=M(),u=P({username:"",number:"",bio:""}),x=M(),l=P({oldPassword:"",newPassword:"",confirmPassword:""}),q={oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"},{max:20,message:"密码长度不能超过20位",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"},{max:20,message:"密码长度不能超过20位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(a,e,d)=>{e!==l.newPassword?d(new Error("两次输入的密码不一致")):d()},trigger:"blur"}]},g=P({emailNotification:!0,recommendNotification:!0,activityNotification:!1}),A=T(),S=async()=>{var a,e,d,_;i.profile=!0;try{const w=(await B.get("/api/user/personal/profile")).data;Object.assign(m,w),u.username=w.username,u.number=w.number,u.bio=w.bio||""}catch(f){console.error("Error fetching user profile:",f.response||f);const w=((e=(a=f.response)==null?void 0:a.data)==null?void 0:e.message)||((d=f.response)==null?void 0:d.data)||f.message||"获取用户信息失败";n.error(w),((_=f.response)==null?void 0:_.status)===401&&A.push("/login")}finally{i.profile=!1}},D=a=>{const e=a.type==="image/jpeg"||a.type==="image/png",d=a.size/1024/1024<2;return e||n.error("头像图片只能是 JPG/PNG 格式!"),d||n.error("头像图片大小不能超过 2MB!"),e&&d},j=a=>{m.photo=a.data,n.success("头像更新成功")},G=()=>{n.error("头像上传失败")},z=async()=>{var a,e;if(F.value){i.basicInfo=!0;try{await B.put("/api/user/personal/basic-info",u),n.success("基本信息保存成功"),await S()}catch(d){n.error(((e=(a=d.response)==null?void 0:a.data)==null?void 0:e.message)||"保存失败")}finally{i.basicInfo=!1}}},J=async()=>{if(x.value)try{if(await x.value.validate(),l.newPassword===l.oldPassword){n.error("新密码不能与当前密码相同");return}i.password=!0;const a={oldPassword:l.oldPassword.trim(),newPassword:l.newPassword.trim(),confirmPassword:l.confirmPassword.trim()};console.log("Password change request data:",a),await B.put("/api/user/personal/password",a),n.success("密码修改成功"),l.oldPassword="",l.newPassword="",l.confirmPassword=""}catch(a){if(a.response){console.error("Password change error:",a.response.data);const e=a.response.data.message||a.response.data.error||"密码修改失败，请确保密码符合要求并且正确输入当前密码";n.error(e)}else a.message?n.error(a.message):n.error("密码修改失败，请稍后重试")}finally{i.password=!1}},$=()=>{n.success("通知设置保存成功")};return K(()=>{S()}),(a,e)=>{const d=p("el-avatar"),_=p("el-button"),f=p("el-upload"),w=p("el-divider"),V=p("el-card"),E=p("el-col"),b=p("el-input"),c=p("el-form-item"),C=p("el-form"),k=p("el-checkbox"),H=p("el-row"),U=Q("loading");return N(),W("div",Y,[o(H,{gutter:20},{default:s(()=>[o(E,{span:8},{default:s(()=>[I((N(),h(V,{class:"user-card"},{default:s(()=>[r("div",Z,[o(d,{size:100,src:m.photo?`data:image/jpeg;base64,${m.photo}`:pe},null,8,["src"]),o(f,{class:"avatar-uploader",action:"/api/user/personal/photo",headers:R.value,"show-file-list":!1,"before-upload":D,"on-success":j,"on-error":G},{default:s(()=>[o(_,{type:"primary",link:""},{default:s(()=>e[9]||(e[9]=[v("更换头像")])),_:1})]),_:1},8,["headers"])]),r("h3",null,y(m.username||m.email),1),r("p",ee,y(m.email),1),o(w),r("div",oe,[r("div",se,[r("div",ae,y(m.applicationCount),1),e[10]||(e[10]=r("div",{class:"stat-label"},"投递数",-1))]),r("div",re,[r("div",te,y(m.interviewCount),1),e[11]||(e[11]=r("div",{class:"stat-label"},"面试数",-1))]),r("div",le,[r("div",ne,y(m.collectionCount),1),e[12]||(e[12]=r("div",{class:"stat-label"},"收藏数",-1))])])]),_:1})),[[U,i.profile]])]),_:1}),o(E,{span:16},{default:s(()=>[I((N(),h(V,{class:"mb-20"},{header:s(()=>[r("div",de,[e[14]||(e[14]=r("span",null,"基本信息",-1)),o(_,{type:"primary",onClick:z,loading:i.basicInfo},{default:s(()=>e[13]||(e[13]=[v(" 保存修改 ")])),_:1},8,["loading"])])]),default:s(()=>[o(C,{model:u,"label-width":"100px",ref_key:"basicFormRef",ref:F},{default:s(()=>[o(c,{label:"昵称",prop:"username"},{default:s(()=>[o(b,{modelValue:u.username,"onUpdate:modelValue":e[0]||(e[0]=t=>u.username=t),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),o(c,{label:"手机号码",prop:"number"},{default:s(()=>[o(b,{modelValue:u.number,"onUpdate:modelValue":e[1]||(e[1]=t=>u.number=t),placeholder:"请输入手机号码"},null,8,["modelValue"])]),_:1}),o(c,{label:"个人简介",prop:"bio"},{default:s(()=>[o(b,{modelValue:u.bio,"onUpdate:modelValue":e[2]||(e[2]=t=>u.bio=t),type:"textarea",rows:3,placeholder:"请输入个人简介"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})),[[U,i.basicInfo]]),I((N(),h(V,{class:"mb-20"},{header:s(()=>[r("div",ie,[e[16]||(e[16]=r("span",null,"修改密码",-1)),o(_,{type:"primary",onClick:J,loading:i.password},{default:s(()=>e[15]||(e[15]=[v(" 确认修改 ")])),_:1},8,["loading"])])]),default:s(()=>[o(C,{model:l,rules:q,ref_key:"passwordFormRef",ref:x,"label-width":"100px"},{default:s(()=>[o(c,{label:"当前密码",prop:"oldPassword"},{default:s(()=>[o(b,{modelValue:l.oldPassword,"onUpdate:modelValue":e[3]||(e[3]=t=>l.oldPassword=t),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),o(c,{label:"新密码",prop:"newPassword"},{default:s(()=>[o(b,{modelValue:l.newPassword,"onUpdate:modelValue":e[4]||(e[4]=t=>l.newPassword=t),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),o(c,{label:"确认密码",prop:"confirmPassword"},{default:s(()=>[o(b,{modelValue:l.confirmPassword,"onUpdate:modelValue":e[5]||(e[5]=t=>l.confirmPassword=t),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})),[[U,i.password]]),o(V,null,{header:s(()=>[r("div",ue,[e[18]||(e[18]=r("span",null,"通知设置",-1)),o(_,{type:"primary",onClick:$},{default:s(()=>e[17]||(e[17]=[v("保存设置")])),_:1})])]),default:s(()=>[o(C,{model:g},{default:s(()=>[o(c,null,{default:s(()=>[o(k,{modelValue:g.emailNotification,"onUpdate:modelValue":e[6]||(e[6]=t=>g.emailNotification=t)},{default:s(()=>e[19]||(e[19]=[v(" 接收邮件通知 ")])),_:1},8,["modelValue"]),e[20]||(e[20]=r("div",{class:"form-tip"},"包括简历被查看、面试邀请等重要通知",-1))]),_:1}),o(c,null,{default:s(()=>[o(k,{modelValue:g.recommendNotification,"onUpdate:modelValue":e[7]||(e[7]=t=>g.recommendNotification=t)},{default:s(()=>e[21]||(e[21]=[v(" 接收职位推荐 ")])),_:1},8,["modelValue"]),e[22]||(e[22]=r("div",{class:"form-tip"},"根据您的求职意向定期推送相关职位",-1))]),_:1}),o(c,null,{default:s(()=>[o(k,{modelValue:g.activityNotification,"onUpdate:modelValue":e[8]||(e[8]=t=>g.activityNotification=t)},{default:s(()=>e[23]||(e[23]=[v(" 接收活动通知 ")])),_:1},8,["modelValue"]),e[24]||(e[24]=r("div",{class:"form-tip"},"包括求职技巧分享、行业交流会等活动信息",-1))]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})])}}});const be=X(me,[["__scopeId","data-v-62065b3e"]]);export{be as default};
