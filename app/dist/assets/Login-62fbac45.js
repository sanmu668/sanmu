import{d as V,u as h,r as v,G as C,b as i,e as I,B as L,h as r,g as s,i as d,j as g,E as u}from"./index-a7f98987.js";import{l as N}from"./auth-6ba2c8cd.js";import{_ as B}from"./_plugin-vue_export-helper-c27b6911.js";import"./request-e257bb45.js";import"./axios-3a665b0f.js";function R(p){if(!p)return null;const l=p.split(".")[1],a=atob(l);return JSON.parse(a)}const S={class:"login-container"},E={class:"register-link"},F=V({__name:"Login",setup(p){const l=h(),a=v(!1),m=v(),t=C({email:"",password:""}),w={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}]},y=async()=>{if(m.value)try{if(!await m.value.validate())return;a.value=!0;const e=await N({email:t.email,password:t.password});if(!e||!e.token){u.error("登入失败，未返回token");return}const n=e.token;localStorage.setItem("token",n);const o=R(n);if(console.log("Token解析结果：",o),!o){u.error("登入失败，token解析失败");return}localStorage.setItem("userInfo",JSON.stringify({email:o.sub,role:o.role})),o.role==="admin"?(u.success("管理员登入成功"),l.push("/admin")):(u.success("登入成功"),l.push("/"))}catch(c){console.error("登入失败",c),u.error("登入失败，请检查邮箱和密码")}finally{a.value=!1}},k=()=>{l.push("/register")};return(c,e)=>{const n=i("el-input"),o=i("el-form-item"),_=i("el-button"),b=i("el-form"),x=i("el-card");return I(),L("div",S,[r(x,{class:"login-card"},{header:s(()=>e[2]||(e[2]=[d("div",{class:"card-header"},[d("h2",null,"智简未来"),d("p",null,"智能招聘系统")],-1)])),default:s(()=>[r(b,{model:t,rules:w,ref_key:"loginFormRef",ref:m,"label-width":"0",size:"large"},{default:s(()=>[r(o,{prop:"email"},{default:s(()=>[r(n,{modelValue:t.email,"onUpdate:modelValue":e[0]||(e[0]=f=>t.email=f),placeholder:"请输入邮箱","prefix-icon":"Message"},null,8,["modelValue"])]),_:1}),r(o,{prop:"password"},{default:s(()=>[r(n,{modelValue:t.password,"onUpdate:modelValue":e[1]||(e[1]=f=>t.password=f),type:"password",placeholder:"请输入密码","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),r(o,null,{default:s(()=>[r(_,{type:"primary",class:"login-button",onClick:y,loading:a.value},{default:s(()=>e[3]||(e[3]=[g(" 登录 ")])),_:1},8,["loading"])]),_:1}),d("div",E,[e[5]||(e[5]=g(" 还没有账号？")),r(_,{type:"text",onClick:k},{default:s(()=>e[4]||(e[4]=[g("立即注册")])),_:1})])]),_:1},8,["model"])]),_:1})])}}});const U=B(F,[["__scopeId","data-v-04f86904"]]);export{U as default};
